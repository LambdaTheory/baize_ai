# ComfyUI工作流导出功能说明

## 功能概述

为了解决ComfyUI用户在原图片丢失后仍需要重新生成图片的问题，我们新增了**ComfyUI工作流导出功能**。

## 功能特点

✅ **智能识别**: 自动识别ComfyUI生成的图片  
✅ **数据安全**: 工作流数据永久保存在本地数据库中  
✅ **一键导出**: 点击按钮即可将完整的workflow.json导出  
✅ **即使原图丢失**: 也能导出完整的工作流文件  

## 使用方法

### 1. 导入ComfyUI图片
- 将ComfyUI生成的图片拖拽到工具中
- 系统会自动提取并保存完整的工作流数据

### 2. 导出工作流
1. 在图片信息区域，如果是ComfyUI图片且包含工作流数据
2. 会自动显示绿色的**"导出工作流"**按钮
3. 点击按钮选择保存位置
4. 系统将导出完整的workflow.json文件

### 3. 使用导出的工作流
1. 打开ComfyUI界面
2. 点击"Load"按钮
3. 选择导出的workflow.json文件
4. 工作流将完全加载到ComfyUI中
5. 点击"Queue Prompt"重新生成图片

## 技术实现

### 按钮显示逻辑
```python
# 只有同时满足以下条件才显示导出按钮：
1. 图片来源为ComfyUI (generation_source == 'ComfyUI')
2. 包含有效的工作流数据 (workflow_data 不为空)
```

### 导出文件格式
- **文件名**: `{原图片名}_workflow.json`
- **编码**: UTF-8
- **格式**: 标准JSON，带缩进格式化
- **兼容性**: 完全兼容ComfyUI原生工作流格式

## 使用场景

### 场景1: 原图意外删除
1. 原始ComfyUI图片被意外删除
2. 但工作流数据仍保存在工具的数据库中
3. 通过历史记录找到对应记录
4. 点击"导出工作流"按钮
5. 导入ComfyUI重新生成

### 场景2: 工作流分享
1. 想要分享某个工作流给其他人
2. 不需要分享完整的图片文件
3. 只需导出轻量的workflow.json文件
4. 其他人可直接导入使用

### 场景3: 工作流备份
1. 定期导出重要的工作流文件
2. 建立个人工作流库
3. 防止意外丢失

## 优势对比

| 传统方式 | 新功能 |
|---------|--------|
| 必须保留原图片 | 原图丢失也能导出 |
| 文件体积大(图片+工作流) | 只导出轻量JSON文件 |
| 手动提取工作流复杂 | 一键导出，操作简单 |
| 容易丢失工作流数据 | 数据库永久保存 |

## 注意事项

1. **仅支持ComfyUI图片**: 只有ComfyUI生成的图片才会显示导出按钮
2. **需要完整工作流数据**: 部分ComfyUI图片可能不包含完整工作流信息
3. **文件路径**: 建议选择易于管理的文件夹保存导出的工作流
4. **版本兼容性**: 导出的工作流与ComfyUI版本兼容性取决于原始生成时的版本

## 故障排除

### 按钮不显示？
- 检查图片是否为ComfyUI生成
- 检查图片是否包含完整的工作流数据
- 重新拖拽图片到工具中

### 导出失败？
- 检查选择的保存路径是否有写入权限
- 检查磁盘空间是否充足
- 查看控制台错误信息

### ComfyUI无法加载？
- 检查导出的JSON文件格式是否正确
- 确认ComfyUI版本兼容性
- 检查工作流中使用的节点是否都已安装

## 技术支持

如果在使用过程中遇到问题，请：
1. 查看控制台输出的错误信息
2. 检查工作流数据是否完整
3. 确认ComfyUI版本和节点兼容性

---

**这个功能彻底解决了ComfyUI用户最担心的工作流丢失问题！** 🎉 